# unix-sort

`unix-sort` — это реализация Unix-подобной утилиты sort на Go с поддержкой внешней сортировки больших файлов. Проект ориентирован на работу с файлами, которые не помещаются в память, с использованием многопоточности и буферизации.

## Возможности
| Флаг              | Описание                                               |
| ----------------- | ------------------------------------------------------ |
| `-k`              | Номер колонки для сортировки (считая с 1)              |
| `-n`              | Числовая сортировка                                    |
| `-r`              | Обратный порядок                                       |
| `-u`              | Уникальные строки                                      |
| `-M`              | Сортировка по месяцам (Jan–Dec)                        |
| `-h`              | Human-readable числа (1K, 2M, 3G)                      |
| `-b`              | Игнорировать пустые строки                             |
| `-c`              | Проверка отсортированности файла без записи результата |
| `-S`              | Размер буфера для чтения (по умолчанию 256MB)          |
| `-T`              | Директория для временных файлов                        |
| `-o`              | Файл для записи результата (по умолчанию stdout)       |
| `--keep-temps`    | Не удалять временные файлы после сортировки            |

Во всех спорных моментах реализация соответствует [документации GNU](https://www.gnu.org/software/coreutils/manual/html_node/sort-invocation.html)


## Структура проекта
```
cmd/unix-sort       # точка входа программы
internal/args       # парсинг аргументов командной строки
internal/reader     # чтение и разбиение файлов на чанки
internal/sorter     # сортировка чанков и k-way merge
internal/writer     # запись отсортированных данных
tests/              # тестовые файлы и тесты
```

## Пошаговое описание работы

### Чтение (`Reader`)

- Запускается в отдельной горутине
- Открывает файлы или STDIN
- Считывает данные в буффер с помощью bufio.Scanner
- Сбор строк в чанки до достижения BufSize (по умолчанию 256MB)
- Канал chan []string передаёт чанки в сортировщик

### Сортировка чанков (`Sorter`)
- Создается функция компаратор для заданых параметров сортировки
- Создаётся пул воркеров в кол-ве GOMAXPROCS 
- Воркеры читают чанки из канала, сортируют их и передают в канал для Writer
- Одна горутина читает из канала отсортированные чанки и записывает их во временные файлы

### [K-way Merge](https://en.wikipedia.org/wiki/K-way_merge_algorithm)
- Все временные файлы открываются
- Каждая очередь (Scanner по файлу) помещает первую строку в min-heap
- Достаем минимальный элемент из кучи и кладем его в выходной канал
- Берем следующую строку из того же файла и помещаем в кучу
- Процесс повторяется, пока куча не станет пустой -> гарантированно глобально отсортированный поток

### Финальная запись (`Writer`)
- Канал с результатом merge записывается в OutputFile или stdout
- Если Unique=true -> повторяющиеся подряд строки фильтруются
- Удаление временных файлов (если нет флага --keep-temps)
